<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Receitas</title>
    <link rel="stylesheet" href="CSS/receita.css" />
    <link rel="stylesheet" href="CSS/drop.css">
    <link rel="stylesheet" href="CSS/barrapesquisa.css">
    <style>
        .receita-item {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .receita-item h3 {
            margin-top: 0;
            margin-bottom: 5px;
        }

        .receita-item p {
            margin-bottom: 8px;
        }

        .adicionar-favorito {
            background: none;
            border: 1px solid #007bff;
            color: #007bff;
            font-size: 1em;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .adicionar-favorito:hover {
            background-color: #e0f7fa;
        }

        .receitas-lista-sidebar button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 5px;
            border: none;
            background-color: #f0f0f0;
            border-radius: 5px;
            cursor: pointer;
            text-align: left;
            transition: background-color 0.3s ease;
        }

        .receitas-lista-sidebar button:hover {
            background-color: #e0e0e0;
        }

        .receitas-lista-sidebar p {
            text-align: center;
            color: #ccc;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <aside class="sidebar">
            <h3>Receitas</h3>
            <ul class="ingredientes-lista receitas-lista-sidebar" id="lista-receitas-sidebar">
            </ul>
        </aside>

        <main class="main-content">
            <header class="topbar">
                <nav>
                    <div id="navbar">
                        <a href="pag-receita.html">Receitas</a>
                        <span>|</span>
                        <a href="home-r.html">Início</a>
                        <span>|</span>
                        <a href="favoritos.html" class="ativo">Favoritos</a>
                        <div class="dropdown" id="menuDropdown">
                            <button class="dropdown-btn" onclick="toggleDropdown()"></button>
                            <div class="dropdown-content">
                                <a href="pag-ingredientes.html">ingredientes</a>
                            </div>
                        </div>
                    </div>
                </nav>
                <div class="search-container">
                    <svg viewBox="0 0 24 24">
                        <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5
                                    6.5 6.5 0 109.5 16c1.61 0 3.09-.59
                                    4.23-1.57l.27.28v.79l5 4.99
                                    L20.49 19l-4.99-5zm-6 0C8.01
                                    14 6 11.99 6 9.5S8.01 5
                                    10.5 5 15 7.01 15 9.5
                                    12.99 14 10.5 14z" />
                    </svg>
                    <input type="search" name="pesquisa" placeholder="Pesquisar" required>
                </div>
            </header>

            <section class="sugestoes">
                <h2>Lista de Receitas</h2>
                <div id="lista-receitas-principal">
                </div>
            </section>
        </main>
    </div>
    <script src="js-pages/dropdown.js"></script>
    <script>
        async function carregarReceitas() {
            try {
                const response = await fetch('http://127.0.0.1:8000/minhas_receitas', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });

                if (!response.ok) {
                    console.error(`Erro ao buscar receitas: ${response.status}`);
                    return;
                }

                const receitas = await response.json();
                const listaReceitasPrincipal = document.getElementById('lista-receitas-principal');
                const listaReceitasSidebar = document.getElementById('lista-receitas-sidebar');

                listaReceitasPrincipal.innerHTML = ''; // Limpa o conteúdo anterior
                listaReceitasSidebar.innerHTML = ''; // Limpa o conteúdo anterior da sidebar

                if (receitas && receitas.length > 0) {
                    // Exibir as primeiras receitas na sidebar
                    const primeirasReceitasSidebar = receitas.slice(0, 4);
                    primeirasReceitasSidebar.forEach(receita => {
                        const botaoReceita = document.createElement('button');
                        botaoReceita.textContent = receita.title;
                        botaoReceita.addEventListener('click', () => exibirDetalhesReceita(receita));
                        listaReceitasSidebar.appendChild(botaoReceita);
                    });

                    const separador = document.createElement('p');
                    separador.textContent = '________';
                    listaReceitasSidebar.appendChild(separador);

                    const espaco = document.createElement('p');
                    espaco.innerHTML = '&nbsp;';
                    listaReceitasSidebar.appendChild(espaco);

                    const botaoMaisReceitas = document.createElement('button');
                    botaoMaisReceitas.textContent = '+ Receitas';
                    // Adicionar lógica para carregar mais receitas ou navegar para outra página
                    listaReceitasSidebar.appendChild(botaoMaisReceitas);

                    // Exibir todas as receitas principais
                    receitas.forEach(receita => {
                        const receitaItem = document.createElement('div');
                        receitaItem.classList.add('receita-item');

                        const titulo = document.createElement('h3');
                        titulo.textContent = receita.title;

                        const ingredientes = document.createElement('p');

                        let ingredientesTexto;
                        try {
                            const ingredientesArray = JSON.parse(receita.ingredients);
                            ingredientesTexto = Array.isArray(ingredientesArray) ? ingredientesArray.join(', ') : receita.ingredients;
                        } catch {
                            ingredientesTexto = receita.ingredients;
                        }
                        ingredientes.textContent = `Ingredientes: ${ingredientesTexto}`;

                        const instrucoes = document.createElement('p');
                        instrucoes.textContent = `Instruções: ${receita.instructions.substring(0, 150)}...`;

                        const botaoFavoritar = document.createElement('button');
                        botaoFavoritar.classList.add('adicionar-favorito');
                        botaoFavoritar.textContent = 'Adicionar aos Favoritos';
                        botaoFavoritar.addEventListener('click', () => adicionarAosFavoritos(receita.id));

                        receitaItem.appendChild(titulo);
                        receitaItem.appendChild(ingredientes);
                        receitaItem.appendChild(instrucoes);
                        receitaItem.appendChild(botaoFavoritar);
                        listaReceitasPrincipal.appendChild(receitaItem);
                    });

                } else {
                    const mensagem = document.createElement('p');
                    mensagem.textContent = 'Nenhuma receita encontrada.';
                    listaReceitasPrincipal.appendChild(mensagem);
                }

            } catch (error) {
                console.error("Erro ao carregar as receitas:", error);
            }
        }

        async function adicionarAosFavoritos(receitaId) {
            try {
                const response = await fetch('http://127.0.0.1:8000/curtir', {
                    credentials: "include",
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ receita_id: receitaId })
                });

                if (!response.ok) {
                    console.error(`Erro ao adicionar aos favoritos: ${response.status}`);
                    // Adicionar feedback ao usuário sobre o erro
                    return;
                }

                const data = await response.json();
                console.log(data.message); // Exibir mensagem de sucesso
                // Adicionar feedback visual ao usuário (por exemplo, mudar o texto do botão)
            } catch (error) {
                console.error("Erro ao adicionar aos favoritos:", error);
            }
        }

        function exibirDetalhesReceita(receita) {
            // Implementar a lógica para exibir os detalhes completos da receita
            console.log("Detalhes da receita:", receita);
            // Você pode redirecionar para outra página ou atualizar o conteúdo da página atual
        }

        window.onload = carregarReceitas;
    </script>
</body>

</html>